# P8-Realtime_invade_detection
<h2>1. 서 론</h2>  
 열감지 센서를 이용한 기존 연구 및 사례들은 Beacon 통신을 사용하거나 열선과 영상 센서 두 가지를 모두 사용하여 침입자를 판단하는 시스템들이 있다.   
 그러나 이러한 방법들은 스마트폰이 강제된다는 단점과 열선과 영상 센서 모두를 사용하여 비용이 많이 소모된다는 단점이 존재한다.   
 이러한 단점들을 해결하고 편리성 향상을위해 열감지 센서만으로 침입자를 효과적으로 판단할 수있는 연구를 진행하고자 한다.   
 이기종 외 3인의 연구에서는 방에 설치된 열감지 센서와 LSTM AutoEncoer를 이용하여 거주자와 침입자 구분시스템을 개발하고자 한다.   
 LSTM AutoEncoer 기반 이상시퀀스 탐지 기법은 참고 문헌[1]을 참고하여 거주자의일상적인 이동 패턴을 이용하여 학습하고 학습한 모델을  
 이용하여 훈련되지 않는 이동패턴이 감지될 경우 침입자로 판단하고 거주자에게 알림을 보내게 된다.  
 
 
<h2>2. 하드웨어 설계</h2>  
 라즈베리파이4(Raspberry Pi 4 Model B) 4GB, 열감지 센서(Adafruit AMG8833 IR Thermal Camera Breakout[ada-3538]), 라즈베리파이4 5V 알래스카 듀얼팬 키트  
 (SZH-RPI02), 라즈베리파이 전원 어댑터와 male-female선으로 구성된다.  
 라즈베리파이4의 1번(power), 3번(SDA), 5번(SCL), 9번(Ground) 핀에 열감지 센서의 VIN, SDA, SCL, GND를 동일하게 연결한다.   
 4번과 6번핀에 듀얼팬 키트를 연결한다. 듀얼팬 키트와 방열판을 사용함으로써 라즈베리파이 4의 장시간 사용에도 기기의 과열을 방지할 수 있다.  
 라즈베리파이4에 라즈비안 os를 설치하고 노트북과 라즈베리파이4를 Micro HDMI to HDMI Cable을 사용하여 연결시킨 후 노트북에서 라즈베리파이4를 사용하게 한다.  
 라즈베리파이4에 Adafruit Python GPIO 라이브러리를 설치하고 라이브러리 폴더에 있는 thermal_cam.py와 pixels_test.py를 실행하여 열감지 센서로 초당 8 x 8 개의 온도 값들을 확인하고   
 열감지 센서 화면을 확인할 수 있다.   
 딥러닝을 수행한 모델로 실시간 데이터를 판단하는데 이 때 true값이 6개 이상이 나오게 되면 침입자로 판단하여 거주자의 휴대폰에 실시간 침입자 감지 알림을 보낸다.  
<h2>3. 데이터 가공</h2>  
 Real-time 침입자 감지를 위해서 실시간으로 저장되는 열감지 센서의 데이터 값을 데이터베이스 서버에 전송 및 저장한다.   
 전송할 때의 데이터 값은 1초마다 8 x 8 개의 값을 가진 한 개의 1차원 리스트를 전송한다. 추후에 1초마다 전송되는 대량의 데이터들을 저장시키기 위해 개인 서버가 아닌   
 firebase Real-time Database를 서버로 사용한다.  
 자세한 데이터 가공 내용은 본문 3.1에 기재. 본문 3.1과 본문 3.2를 진행할 시 20초동안 쌓인 데이터(64개 x 20초)가 한 개의 리스트에 저장되며 이 저장된 리스트를테스트 데이터로 사용해 침입자 감지를 수행한다.  
 열감지 센서와 LSTM을 활용한 실시간 침입자 감지 시스템  
   
요 약  
 열감지 센서를 이용하는 침입자 감지 시스템들은 많이 연구되었지만 이는 단순한 침입 감지로 인하여 침입자를 구분하는 것일 뿐 침입자와 거주자의 차이를 구분하지 못한다.   
 본 논문에서는 열감지 센서의 온도 데이터를 LSTM AutoEncoder를 이용하여 학습한 모델로 거주자와 침입자의 다른 이동패턴을 파악하고  
 침입자를 보다 정확하게 구분하고자 한다. 침입자 감지 모델의 성능을 향상시키기 위하여 모델의 epochs, LSTM AutoEncoder의 입력층 구조, 슬라이딩 윈도우 등의 변화를 통하여   
 가장 좋은 모델을 찾고 이를 이용하여 침입자를 보다 정확하게 구분한다.  
 가장 좋은 침입자 감지 모델을 이용하여 침입자가 침입하였을 경우 모델은 침입자를 인식하고 거주자의 핸드폰으로 알림을 보내도록 구성한다.  
   
<h3>3.1 실시간 데이터 가공</h3>  
 실시간으로 침입자를 감지하는 프로그램에서 firebase Real-time Database 서버를 통해 실시간으로 계속 저장되는 데이터를 전달받는다.   
 이 데이터 값들은 dict 형식으로 전달 받으며 이를 날짜는 key로 그에 맞는 데이터값은 value로 저장한다.   
 저장할 때의 데이터는 가장 최근의 데이터 30개를 가져온다.   
 이는 본문 3.2에 기재된 슬라이딩 윈도우를 위함이며 데이터 손실을 막기 위함이다.  
 날짜와 데이터 값으로 데이터 프레임 생성 후 구분자를 없애기 위한 가공을 진행한다.    
     
<h3>3.2 슬라이딩 윈도우</h3>  
 슬라이딩 윈도우는 참고문헌 [2]을 참고하였으며 [2]에서 사용한 방법을 본 연구의 데이터에 맞게 수정 후 사용하였다.   
 슬라이딩 윈도우를 진행할 때 원본 데이터와 가공할 데이터 형식, lookback를 파라미터로 제공받는다.   
 여기서 lookback은 윈도우 사이즈이며 본 연구의 목적인 이동 패턴 학습의 정확성을 위해 실제 진행한 실험에서는 윈도우 사이즈를 20으로 지정한 후 실험을 진행하였다.   
 슬라이딩 윈도우를 수행할 때는 pandas 패키지의 shift를 사용해 간단하고 효율적인 슬라이딩을 진행하였다.   
 그림으로 표현하면 <그림1>과 같으며, 후에 생성되는 데이터의 앞 20개의 데이터는 NULL값이 존재하므로, 삭제해준다.  
   
   ![image](https://user-images.githubusercontent.com/52438368/123590658-e4444100-d825-11eb-86bb-882aaaa0ac9c.png)  
<그림1>  
<h2>4. 딥러닝 모델 구조 비교</h2>  
 모델의 원활한 비교를 위해 batch size는 20으로 고정하였고, 훈련 데이터는 거주자의 일상 생활 30분을 사용하고, 테스트 데이터로는 과장된 침입자 데이터 3분을 사용한다.  
 epochs, LSTM AutoEncoder의 입력층 구조, 슬라이딩 윈도우를 통해 가장 최적의 모델을 찾기 위해 다양한 경우를 비교해 보았다.  
 <표1>은 과정에서 유의미한 비교군으로 구성한다.  
 <표1>  
 LSTM dropout sliding epochs loss 임계값순으로  
 64-16 0.3 x 200 0.72 0.16  
 256-64 0.3 5 100 0.729 0.14  
 640-128 0.3 10 100 0.73 0.12  
 640-128 0.3 10 500 0.582 0.125  
 슬라이딩 윈도우를 함과 동시에 LSTM 입력층의 셀 개수를 확장 시켜주는 것이 더 좋은 성능이 나타남에 따라 증명되었다.  
   
 ![image](https://user-images.githubusercontent.com/52438368/123590672-e73f3180-d825-11eb-901e-9b6c7f4842cf.png)  
 <그림2> 64-16, sliding 0, epochs 200 모델 임계값 비교  
   
     
 ![image](https://user-images.githubusercontent.com/52438368/123590673-e8705e80-d825-11eb-91ef-601537f95bbe.png)  
 <그림3> 256-64, sliding 5, epochs 100 모델 임계값 비교  
   
     
 ![image](https://user-images.githubusercontent.com/52438368/123590676-ea3a2200-d825-11eb-8cbd-e2ce20f29793.png)  
 <그림4> 640-128, sliding 10, epochs 100 모델 임계값 비교  
   
     
   
 <그림2>는 침입자 행동의 초기 부분만 잘 감지할 뿐 그 이후의 결과는 잘 감지하지 못하는 결과가 나타난다.  
 <그림3>는 침입자 데이터가 잘 감지되지만 <그림4>과 비교했을 때 <그림3>이 훨씬 높은 임계값 차이로 침입자 를 더 정확하게 판단하는 모델이라고 볼 수 있다  
   
     
 ![image](https://user-images.githubusercontent.com/52438368/123590682-eb6b4f00-d825-11eb-810a-dac4b03dce5e.png)  
 <그림5> 640-128, dropout 0.3, sliding 10, epochs 500 모델의 epochs당 loss 그래프  
  
    
  
  ![image](https://user-images.githubusercontent.com/52438368/123590871-3f763380-d826-11eb-99f1-ac4e5c9eb698.png)  
 <그림6> 640-128, dropout 0.3, sliding 10, epochs 500 모델의 loss 분포 그래프  
   
     
  
 <그림4>와 <그림5>을 비교해 보았을때, <표1>의 마지막 모델은 과적합(overfitting)이 일어났다는 것을 확인할 수 있다.   
 150을 넘어가면 과적합이 발생하여 epochs는 100에서 150사이가 가장 적합하다.  
 후에 거주자와 행동이 비슷한 침입자 감지와 실시간 감지 시에는 슬라이딩윈도우 수행 시 윈도우 사이즈를 20으로 LSTM 모델의 입력층은 1280-320, 드랍아웃 0.3으로 설정하였다.  
<h2>5. 향후 연구 및 결론</h2>  
 본 논문에서는 열감지 센서와 LSTM AutoEncoder를 활용한 실시간 침입자 감지 시스템을 데이터 가공 기법과모델 구조의 다양화를 통하여 최적의 모델을 선정할 수 있도록 분석하였다.   
 또한 분석한 결과를 토대로 실시간 침입자 감지 시 정확한 판단을 할 수 있도록 연구하였다.   
 향후 연구로는 모델 구조의 다양화를 통해 최적의 모델을 훈련하여 더 정확하고 신속한 판단을 할 수 있도록 연구할 계획이다.   
   
   
 참고문헌  
 [1] 이주연, 이기용 "확장된 LSTM 오토인코더 기반 이상시퀀스 탐지 기법" 한국전자거래학회지 v.26 no.1 , 2021년, pp.127 - 140  
 [2] JAGADEESH23, Multivariate Multi-step Time SeriesForecasting using Stacked LSTM sequence to sequenceAutoencoder in Tensorflow 2.0 / Keras, AnalyticsVidhya, 2020.  

